# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript
variables: 
  APIKEY : $APIKEY
  APISECRET : $APISECRET
  PREVIOUS_SHA : 5cfd6e1cedf9ba5832bb598fe415c164e1256fe6
  CURRENT_SHA : $(system.pullRequest.sourceCommitId)
  HAPPO_CONFIG_FILE : './config.js'

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- bash: |
    value=$(sed 's/.....$//' <<< $(System.PullRequest.SourceRepositoryURI))/$(System.PullRequest.PullRequestNumber)
    echo "##vso[task.setvariable variable=CHANGE_URL]$value"

- task: NodeTool@0
  inputs:
    versionSpec: '10.x'
  displayName: 'Install Node.js'

- script: |
    npm install
    npm run happo-ci
  displayName: 'yarn install and run happo'
